import streamlit as st
import json
from pathlib import Path

# Page config
st.set_page_config(
    page_title="ููุตุฉ ุชูููู ุงููุฏุฑุงุช ุงููุนุฑููุฉ - ูุฒุงุฑุฉ ุงูุนูู",
    page_icon="๐ง",
    layout="wide",
    initial_sidebar_state="expanded"
)

# Arabic RTL styling
st.markdown(""" """, unsafe_allow_html=True)

# Database helpers
DB_PATH = Path(__file__).with_name("demo_db_arabic.json")

def load_db():
    try:
        with open(DB_PATH, 'r', encoding='utf-8') as f:
            return json.load(f)
    except FileNotFoundError:
        # Initialize empty database
        empty_db = {
            "questions": [],
            "exams": [],
            "submissions": []
        }
        with open(DB_PATH, 'w', encoding='utf-8') as f:
            json.dump(empty_db, f, ensure_ascii=False, indent=2)
        return empty_db

# Header
st.markdown("""
๐ง ููุตุฉ ุชูููู ุงููุฏุฑุงุช ุงููุนุฑููุฉ  
ูุฒุงุฑุฉ ุงูุนูู - ุณูุทูุฉ ุนููุงู
""", unsafe_allow_html=True)

# Introduction
st.markdown("""
#### ๐ก ูุณุฎุฉ ุชุฌุฑูุจูุฉ ูุชูุฏูุฉ

ูุฐู ูุณุฎุฉ ุชุฌุฑูุจูุฉ ุดุงููุฉ ูู ููุตุฉ ุชูููู ุงููุฏุฑุงุช ุงููุนุฑููุฉ ุงูุชู ุชุชุถูู ูุฑุญูุชูู ูุชูุงููุชูู:  
##### ๐ฏ ุงููุฑุญูุฉ ุงูุฃููู: ุชุทููุฑ ุงููุญุชูู
- ุชูููุฏ ุงูุฃุณุฆูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
- ูุฑุงุฌุนุฉ ูููุงููุฉ ุงูุฎุจุฑุงุก
- ุชุฌููุน ุงูุงุฎุชุจุงุฑุงุช
##### ๐ ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุงูุชุดุบูู
- ุชูุฏูู ุงูุงุฎุชุจุงุฑุงุช ููุทูุงุจ
- ุงูุชุตุญูุญ ูุงููุฑุงุฌุนุฉ
- ุงูุชุญูููุงุช ูุงูุชูุงุฑูุฑ
""", unsafe_allow_html=True)

# Load and display metrics
try:
    data = load_db()
    col1, col2, col3, col4 = st.columns(4)
    with col1:
        total_questions = len(data.get('questions', []))
        st.metric(label="๐ ุฅุฌูุงูู ุงูุฃุณุฆูุฉ", value=total_questions, help="ุงูุนุฏุฏ ุงูุฅุฌูุงูู ููุฃุณุฆูุฉ ูู ุงููุธุงู")
    with col2:
        approved_questions = len([q for q in data.get('questions', []) if q.get('status') == 'approved'])
        st.metric(label="โ ุงูุฃุณุฆูุฉ ุงููุนุชูุฏุฉ", value=approved_questions, help="ุงูุฃุณุฆูุฉ ุงูุชู ุชูุช ุงูููุงููุฉ ุนูููุง")
    with col3:
        total_exams = len(data.get('exams', []))
        st.metric(label="๐ ุงูุงุฎุชุจุงุฑุงุช ุงููุชุงุญุฉ", value=total_exams, help="ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูุฌุงูุฒุฉ")
    with col4:
        total_submissions = len(data.get('submissions', []))
        st.metric(label="๐ฅ ูุญุงููุงุช ุงูุทูุงุจ", value=total_submissions, help="ุนุฏุฏ ุงููุญุงููุงุช ุงููุณุฌูุฉ")
except Exception as e:
    st.error(f"ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช: {e}")

# Features overview
st.markdown("### ๐ ุงููุฒุงูุง ุงูุชูุงูุณูุฉ")
col1, col2, col3 = st.columns(3)
with col1:
    st.markdown("""
##### ๐ค ุงูุฐูุงุก ุงูุงุตุทูุงุนู
โข ุชูููุฏ ุฃุณุฆูุฉ ุนุงููุฉ ุงูุฌูุฏุฉ ุจุงุณุชุฎุฏุงู GPT-4  
โข ููุชุฑุฉ ุฐููุฉ ูููุญุชูู  
โข ููุงุฐุฌ ุงุญุชูุงุทูุฉ ููุชูุญุฉ ุงููุตุฏุฑ  
โข ุชุญุณูู ูุณุชูุฑ ุนุจุฑ ุงูุชุนูู ุงูุขูู
""", unsafe_allow_html=True)
with col2:
    st.markdown("""
##### ๐จโ๐ซ ุถูุงู ุงูุฌูุฏุฉ
โข ูุฑุงุฌุนุฉ ุดุงููุฉ ูู ุฎุจุฑุงุก ุงููุงุฏุฉ  
โข ุชุฏูู ููุงููุฉ ูุชุนุฏุฏ ุงููุฑุงุญู  
โข ูุนุงููุฑ ุฌูุฏุฉ ุตุงุฑูุฉ  
โข ุชุชุจุน ุงูุฃุฏุงุก ูุงูุชุญุณูู
""", unsafe_allow_html=True)
with col3:
    st.markdown("""
##### ๐ ุงูุฃูุงู ูุงูุงูุชุซุงู
โข ูุดุฑ ุฏุงุฎูู ุนูู ุฎูุงุฏู ุงููุฒุงุฑุฉ  
โข ุชุดููุฑ ุดุงูู ููุจูุงูุงุช  
โข ุงูุชุซุงู ููุนุงููุฑ ุงูุฃูุงู ุงูุญููููุฉ  
โข ุชุณุฌูู ุดุงูู ููุฃูุดุทุฉ
""", unsafe_allow_html=True)

# Technical specifications
st.markdown("### โ๏ธ ุงูููุงุตูุงุช ุงูุชูููุฉ")
col1, col2 = st.columns(2)
with col1:
    st.markdown("""
**ุงูุจููุฉ ุงูุชุญุชูุฉ:**
- **ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:** React + TypeScript ูุน ุฏุนู RTL
- **ุงูุฎุงุฏู ุงูุฎููู:** Python FastAPI ูุน ููุงุนุฏ ุงูุจูุงูุงุช ุงููุญููุฉ
- **ูุงุนุฏุฉ ุงูุจูุงูุงุช:** PostgreSQL ูุน Redis ููุชุฎุฒูู ุงููุคูุช
- **ุงูุฐูุงุก ุงูุงุตุทูุงุนู:** OpenAI GPT-4 + ููุงุฐุฌ ูุญููุฉ
""")
with col2:
    st.markdown("""
**ุงูุฃุฏุงุก ูุงูููุซูููุฉ:**
- **ุงูุฏุนู ุงููุชุฒุงูู:** 500+ ูุณุชุฎุฏู
- **ููุช ุงูุงุณุชุฌุงุจุฉ:** ุฃูู ูู 2 ุซุงููุฉ
- **ูุนุฏู ุงูุชุดุบูู:** 99.9% ุฎูุงู ุณุงุนุงุช ุงูุนูู
- **ุงููุณุฎ ุงูุงุญุชูุงุทู:** ุขูู ูููู
""")

# Navigation guide
st.markdown("### ๐ฑ ุฏููู ุงูุงุณุชุฎุฏุงู")
st.markdown("""
ููุงุณุชูุงุฏุฉ ุงููุงููุฉ ูู ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ:  
1๏ธโฃ ุชูููุฏ ุงูุฃุณุฆูุฉ  
ุงุณุชุฎุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุฅูุดุงุก ุฃุณุฆูุฉ ุจู 12 ููุนุงู ูุฎุชููุงู  
2๏ธโฃ ูุฑุงุฌุนุฉ ุงูุฎุจุฑุงุก  
ุฑุงุฌุน ูุงุนุชูุฏ ุงูุฃุณุฆูุฉ ุงููููุฏุฉ ูุจู ุงูุงุณุชุฎุฏุงู  
3๏ธโฃ ุชุฌููุน ุงูุงุฎุชุจุงุฑุงุช  
ุฃูุดุฆ ุงุฎุชุจุงุฑุงุช ูุฎุตุตุฉ ูู ุงูุฃุณุฆูุฉ ุงููุนุชูุฏุฉ  
4๏ธโฃ ุชูุฏูู ุงูุงุฎุชุจุงุฑ  
ุฌุฑุจ ุชุฌุฑุจุฉ ุงูุทุงูุจ ุงููุงููุฉ ูุน ุงูุชูููุช  
5๏ธโฃ ุงูุชุญูููุงุช  
ุงุณุชุนุฑุถ ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช ุงูุชูุตูููุฉ  
๐ก ูุตูุญุฉ: ุงุจุฏุฃ ุจุชูููุฏ ุจุนุถ ุงูุฃุณุฆูุฉุ ุซู ุงุนุชูุฏูุงุ ูุฃูุดุฆ ุงุฎุชุจุงุฑุงู ูุฑุคูุฉ ุงูุชุฏูู ุงููุงูู ูู ุงูุนูู.
""", unsafe_allow_html=True)

# System status
st.markdown("### ๐ง ุญุงูุฉ ุงููุธุงู")
col1, col2, col3 = st.columns(3)

with col1:
    # Improved OpenAI connectivity check
    try:
        openai_key = st.secrets.get("OPENAI_API_KEY")
        if openai_key and openai_key.strip() and openai_key != "your_openai_api_key_here":
            masked_key = "****" + openai_key[-4:]
            st.success(f"๐ข ุงุชุตุงู OpenAI: ููุชุงุญ ูููููู ({masked_key})")
        else:
            st.warning("๐ก ุงุชุตุงู OpenAI: ุบูุฑ ูููููู")
    except Exception as e:
        st.error(f"๐ด ุงุชุตุงู OpenAI: ุฎุทุฃ ({e})")

with col2:
    # Check database
    try:
        data = load_db()
        st.success("๐ข ูุงุนุฏุฉ ุงูุจูุงูุงุช: ูุชุตูุฉ")
    except:
        st.error("๐ด ูุงุนุฏุฉ ุงูุจูุงูุงุช: ุฎุทุฃ")

with col3:
    # Check UI
    st.success("๐ข ูุงุฌูุฉ ุงููุณุชุฎุฏู: ุชุนูู")

# Footer
st.markdown("---")
st.markdown("""
ููุตุฉ ุชูููู ุงููุฏุฑุงุช ุงููุนุฑููุฉ - ูุฒุงุฑุฉ ุงูุนููุ ุณูุทูุฉ ุนููุงู  
ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ ุงููุชูุฏูุฉ  
ุชู ุงูุชุทููุฑ ุฎุตูุตุงู ูู ุฃุฌู ูุฒุงุฑุฉ ุงูุนูู  
ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ ูขููขูฅ
""", unsafe_allow_html=True)
